{% extends "base.html" %}

{% block content %}
<div class="container mt-5 pt-3">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <div class="card">
                <div class="card-header">
                     <h2 class="card-title mb-0">Edit Employee: {{ employee.name }}</h2>
                </div>
                <div class="card-body">
                    <p class="text-light opacity-75">Update the details for {{ employee.employee_id }}.</p>
                    <hr style="border-color: rgba(255,255,255,0.2);">
                    <form method="POST" action="{{ url_for('edit_employee', emp_db_id=employee.id) }}" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="employee_id" class="form-label">Employee ID</label>
                                    <input type="text" class="form-control" id="employee_id" name="employee_id" value="{{ employee.employee_id }}" readonly>
                                    <small class="form-text text-light opacity-50">Employee ID cannot be changed.</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="name" class="form-label">Full Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="name" name="name" value="{{ employee.name }}" required>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="designation" class="form-label">Designation</label>
                                    <input type="text" class="form-control" id="designation" name="designation" value="{{ employee.designation if employee.designation else '' }}">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="phone" class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="phone" name="phone" value="{{ employee.phone if employee.phone else '' }}">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                 <div class="mb-3">
                                    <label for="dob" class="form-label">Date of Birth</label>
                                    <input type="date" class="form-control" id="dob" name="dob" value="{{ employee.dob.strftime('%Y-%m-%d') if employee.dob else '' }}">
                                </div>
                            </div>
                             <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="address" class="form-label">Address</label>
                                    <textarea class="form-control" id="address" name="address" rows="3">{{ employee.address if employee.address else '' }}</textarea>
                                </div>
                            </div>
                        </div>


                        <div class="mb-3">
                            <label for="face_images" class="form-label">Update Face Images (Optional)</label>
                            <input type="file" class="form-control" id="face_images" name="face_images" multiple accept="image/jpeg, image/png">
                            <small class="form-text text-light opacity-75 mt-1">
                                If you upload new images, they will <strong>replace all existing face images</strong> for this employee.
                                Upload 1-3 clear, frontal face images. Live training is also available.
                            </small>
                        </div>
                         <div id="imagePreviewContainer" class="mb-3 d-flex flex-wrap">
                            <!-- Image previews will be shown here -->
                        </div>
                        {#
                        <div class="mb-3">
                            <p class="form-text text-light opacity-50">Current known face images are stored in: <code>static/known_faces/{{ employee.employee_id }}/</code></p>
                        </div>
                        #}

                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary me-2">Save Changes</button>
                            <a href="{{ url_for('manage_employees') }}" class="btn btn-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts_extra %}
<script>
document.getElementById('face_images').addEventListener('change', function(event) {
    const previewContainer = document.getElementById('imagePreviewContainer');
    previewContainer.innerHTML = ''; // Clear previous previews
    const files = event.target.files;
    if (files.length > 0) {
        // const row = document.createElement('div'); // Not using Bootstrap row for simple flex display
        // row.className = 'row g-2';
        // previewContainer.appendChild(row);

        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            if (file.type.startsWith('image/')) {
                // const col = document.createElement('div');
                // col.className = 'col-auto';

                const imgWrapper = document.createElement('div');
                imgWrapper.style.margin = '5px';
                imgWrapper.style.border = '1px solid var(--secondary-white-border)';
                imgWrapper.style.borderRadius = 'var(--border-radius-small)';
                imgWrapper.style.padding = '5px';
                imgWrapper.style.background = 'rgba(255,255,255,0.1)';

                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                img.style.height = '80px'; // Smaller preview
                img.style.width = 'auto';
                img.style.objectFit = 'cover';
                img.style.borderRadius = 'calc(var(--border-radius-small) - 2px)';
                
                // col.appendChild(img);
                // row.appendChild(col);
                imgWrapper.appendChild(img);
                previewContainer.appendChild(imgWrapper);


                img.onload = function() {
                    URL.revokeObjectURL(img.src);
                }
            }
        }
    }
});
</script>
{% endblock %}
